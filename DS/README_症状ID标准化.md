# 症状ID标准化和反向查询系统

## 项目概述

本项目对原始的疾病数据库进行了症状ID标准化处理，解决了以下问题：
1. 相同症状使用不同ID的问题
2. 语义相近症状的统一处理
3. 创建了症状到疾病的反向查询表

## 处理结果统计

### 数据规模
- **原始疾病数**: 9,947个
- **标准化后疾病数**: 9,947个
- **统一症状ID数**: 2,897个
- **反向映射条目数**: 2,897个

### 症状分布
- **平均每症状对应疾病数**: 23.45个
- **最多对应疾病数**: 6,888个 (疼痛)
- **最少对应疾病数**: 1个

### 最常见症状 (Top 10)
1. 疼痛 - 6,888个疾病
2. 疲劳 - 4,150个疾病  
3. 发热 - 2,248个疾病
4. 体重下降 - 1,869个疾病
5. 呼吸困难 - 1,782个疾病
6. 恶心 - 1,673个疾病
7. 头痛 - 1,589个疾病
8. 咳嗽 - 1,136个疾病
9. 腹痛 - 967个疾病
10. 视力模糊 - 963个疾病

## 文件说明

### 输入文件
- `merged_processed_diseases.json` - 合并后的原始疾病数据库

### 输出文件
- `normalized_diseases_database.json` - 标准化后的疾病数据库
- `symptom_to_disease_mapping.json` - 症状到疾病的反向查询表

### 处理脚本
- `symptom_id_normalizer.py` - 主要的标准化处理脚本
- `query_examples.py` - 查询功能演示脚本

## 症状标准化规则

### 语义分组示例
脚本自动将语义相近的症状合并为统一ID：

#### 疼痛相关
- **疼痛**: 疼痛、痛、疼、酸痛、刺痛、胀痛、隐痛、钝痛、剧痛、剧烈疼痛
- **头痛**: 头痛、头疼、偏头痛、头部疼痛、颅内压增高、头胀痛
- **腹痛**: 腹痛、腹部疼痛、肚子痛、胃痛、胃部疼痛、上腹痛、下腹痛
- **胸痛**: 胸痛、胸部疼痛、心前区疼痛、胸闷痛

#### 发热相关
- **发热**: 发热、发烧、体温升高、高热、低热、中等热度、持续发热
- **寒战**: 寒战、畏寒、怕冷、恶寒

#### 呼吸相关
- **咳嗽**: 咳嗽、咳、干咳、湿咳、慢性咳嗽、持续咳嗽、刺激性咳嗽
- **咳痰**: 咳痰、咯痰、痰多、有痰、痰液增多、脓痰、脓性痰
- **呼吸困难**: 呼吸困难、气短、气促、呼吸急促、喘息、喘、气喘

#### 消化相关
- **恶心**: 恶心、想吐、恶心感
- **呕吐**: 呕吐、吐、呕、干呕
- **腹泻**: 腹泻、拉肚子、大便次数增多、稀便、水样便

## 数据结构

### 标准化疾病数据库结构
```json
{
  "疾病库": [
    {
      "疾病ID": "D000005",
      "疾病名称": "喉炎",
      "症状列表": [
        {
          "symptom_id": "SYM_7170BD6B",
          "symptom_name": "吞咽疼痛",
          "disease_id": "D000005",
          "specificity": false,
          "normalized_name": "疼痛"
        }
      ],
      "疾病解释": "..."
    }
  ]
}
```

### 反向查询表结构
```json
{
  "症状反向查询表": {
    "SYM_7170BD6B": {
      "symptom_name": "疼痛",
      "disease_count": 6888,
      "diseases": [
        {
          "disease_id": "D000005",
          "disease_name": "喉炎",
          "specificity": false
        }
      ]
    }
  }
}
```

## 使用方法

### 1. 基本查询
```python
from query_examples import DiseaseSymptomQuery

# 初始化查询系统
query_system = DiseaseSymptomQuery()

# 根据疾病查询症状
symptoms = query_system.query_symptoms_by_disease("喉炎")

# 根据症状查询疾病
diseases = query_system.query_diseases_by_symptom_name("发热")

# 根据多个症状查找共同疾病
common_diseases = query_system.find_common_diseases(["发热", "咳嗽", "疲劳"])
```

### 2. 运行演示
```bash
python query_examples.py
```

### 3. 交互式查询
修改 `query_examples.py` 文件末尾，取消注释 `interactive_query()` 函数调用。

## 技术特点

### 1. 智能症状合并
- 使用语义规则自动识别相近症状
- 基于MD5哈希生成统一的症状ID
- 保持原始症状名称的完整性

### 2. 高效查询
- 双向查询支持：疾病→症状，症状→疾病
- 多症状组合查询
- 统计分析功能

### 3. 数据完整性
- 保留所有原始信息
- 添加标准化字段
- 支持特异性标记

## 应用场景

1. **医疗诊断辅助**: 根据症状组合推荐可能的疾病
2. **疾病知识库**: 快速查询疾病相关症状
3. **医学研究**: 分析症状与疾病的关联性
4. **健康咨询**: 提供症状相关的疾病信息

## 文件大小

- `normalized_diseases_database.json`: ~19.1 MB
- `symptom_to_disease_mapping.json`: ~10.2 MB
- 总计: ~29.3 MB

## 注意事项

1. 症状标准化基于预定义的语义规则，可能需要根据实际需求调整
2. 反向查询表包含大量数据，建议在生产环境中使用数据库存储
3. 查询结果仅供参考，不能替代专业医疗诊断

## 后续改进建议

1. 使用机器学习方法进一步优化症状合并规则
2. 添加症状权重和置信度评分
3. 实现增量更新机制
4. 添加多语言支持
5. 集成到数据库系统中提高查询性能
