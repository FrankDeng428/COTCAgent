# 疾病症状数据库处理工具

使用DeepSeek API验证和补全疾病-症状对应关系，支持多线程并行处理。

## 功能特点

- ✅ 验证现有症状是否与疾病准确对应
- ✅ 修正不准确的症状描述  
- ✅ 补全疾病的主要症状
- ✅ 为每个症状添加特异性判断 (specificity字段)
- ✅ 保持原有症状ID不变
- 🚀 **并行处理支持** - 多线程加速，比串行处理快3-6倍！
- 📊 **实时进度显示** - 显示处理进度和预计剩余时间
- 🛡️ **智能错误处理** - 单个疾病失败不影响整体处理
- 🔄 **自动重试机制** - API调用失败时自动重试最多5次

## 快速开始

### 1. 安装依赖
```bash
pip install -r requirements.txt
```

### 2. 运行程序
```bash
python run_processing.py
```

选择相应的处理方式：
- **选项1**: 快速测试 (并行) - 验证功能
- **选项2**: 分批处理 (并行) - 处理所有数据 (推荐)

## 分批处理特点

- ✅ **断点续传** - 中断后可继续处理
- ✅ **分批保存** - 每处理一批就保存结果
- ✅ **可配置参数** - 自定义批次大小和线程数
- ✅ **避免长时间运行** - 降低系统风险
- ✅ **实时进度显示** - 显示处理进度和预计时间

## 文件说明

### 核心文件
- `disease_symptom_processor_parallel.py` - 分批并行处理主程序
- `run_processing.py` - 主运行脚本 (推荐使用)
- `test_parallel_processor.py` - 并行测试脚本
- `test_batch_processing.py` - 分批处理测试脚本

### 数据文件
- `disease_symptom_database.json` - 原始数据文件
- `requirements.txt` - 依赖包

## 输出格式

处理后的每个疾病包含：
```json
{
  "疾病ID": "D000001",
  "疾病名称": "乳腺炎", 
  "症状列表": [
    {
      "symptom_id": "S002108_014",
      "symptom_name": "乳房疼痛",
      "disease_id": "D000001",
      "specificity": false
    }
  ],
  "疾病解释": "乳腺炎的详细医学描述"
}
```

## 注意事项

- 🚀 **推荐使用并行处理** - 速度快3-6倍
- 🌐 **网络要求** - 需要稳定的网络连接
- ⏱️ **时间成本** - 完整处理仍需1-2小时
- 🔧 **线程配置** - 建议5-10个线程，避免API限制
- 💾 **备份建议** - 处理前请备份原始数据文件